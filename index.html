<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avatar AR - Simple</title>
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        font-family: Arial, sans-serif;
      }
      #startBtn {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #4CAF50;
        color: white;
        border: none;
        padding: 25px 50px;
        font-size: 24px;
        border-radius: 15px;
        cursor: pointer;
        z-index: 10000;
        box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      }
      #info {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.85);
        color: white;
        padding: 15px 25px;
        border-radius: 10px;
        z-index: 9999;
        text-align: center;
        display: none;
        font-size: 16px;
      }
      #testBtn {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(255,0,0,0.9);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 10px;
        z-index: 9999;
        display: none;
        font-size: 18px;
      }
    </style>
  </head>
  <body>
    <button id="startBtn">‚ñ∂ INICIAR AR</button>
    <div id="info">Preparando...</div>
    <button id="testBtn" onclick="placeTest()">üéØ COLOCAR OBJETOS AQU√ç</button>

    <a-scene
      id="scene"
      embedded
      vr-mode-ui="enabled: false"
      renderer="colorManagement: true; alpha: true;"
      style="display: none;">
      
      <a-assets>
        <a-asset-item id="avatarModel" src="avatar.glb"></a-asset-item>
      </a-assets>

      <!-- Luz ambiental fuerte -->
      <a-entity light="type: ambient; intensity: 2"></a-entity>
      <a-entity light="type: directional; intensity: 1.5" position="5 5 5"></a-entity>

      <!-- C√°mara b√°sica -->
      <a-camera id="cam" position="0 1.6 0"></a-camera>

      <!-- Contenedor -->
      <a-entity id="container"></a-entity>
    </a-scene>

    <script>
      let stream = null;
      let scene = null;
      let placed = false;

      // Bot√≥n de inicio
      document.getElementById('startBtn').onclick = async function() {
        this.style.display = 'none';
        const info = document.getElementById('info');
        info.style.display = 'block';
        info.textContent = 'Activando c√°mara...';

        try {
          // Obtener c√°mara
          stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: 'environment' }
          });

          // Mostrar video de fondo
          const video = document.createElement('video');
          video.autoplay = true;
          video.playsInline = true;
          video.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-1';
          video.srcObject = stream;
          document.body.appendChild(video);

          // Mostrar escena
          scene = document.getElementById('scene');
          scene.style.display = 'block';

          info.textContent = '‚úì C√°mara activa - Toca el bot√≥n rojo';
          document.getElementById('testBtn').style.display = 'block';

        } catch (err) {
          info.textContent = '‚ùå Error: ' + err.message;
          console.error(err);
        }
      };

      // Funci√≥n para colocar objetos de prueba
      window.placeTest = function() {
        if (placed) return;
        placed = true;

        const container = document.getElementById('container');
        const info = document.getElementById('info');
        
        info.textContent = 'Colocando objetos...';

        // ESTRATEGIA: Colocar m√∫ltiples objetos en c√≠rculo alrededor del usuario
        // As√≠ GARANTIZAMOS que al menos uno sea visible
        
        const distances = [2, 3, 4]; // Diferentes distancias
        const angles = [0, 45, 90, 135, 180, 225, 270, 315]; // 8 direcciones
        let count = 0;

        angles.forEach((angle, idx) => {
          const rad = angle * Math.PI / 180;
          const dist = distances[idx % distances.length];
          
          const x = Math.sin(rad) * dist;
          const z = -Math.cos(rad) * dist;
          const y = 1;

          // Cubo de prueba
          const box = document.createElement('a-box');
          box.setAttribute('position', `${x} ${y} ${z}`);
          box.setAttribute('scale', '0.5 0.5 0.5');
          box.setAttribute('color', idx === 0 ? '#FF0000' : '#00FF00');
          box.setAttribute('material', 'emissive: ' + (idx === 0 ? '#FF0000' : '#00FF00') + '; emissiveIntensity: 0.8');
          box.setAttribute('animation', 'property: rotation; to: 0 360 0; loop: true; dur: 3000');
          container.appendChild(box);

          // Texto indicador
          const text = document.createElement('a-text');
          text.setAttribute('value', (idx + 1).toString());
          text.setAttribute('position', `${x} ${y + 0.7} ${z}`);
          text.setAttribute('align', 'center');
          text.setAttribute('color', '#FFFF00');
          text.setAttribute('scale', '2 2 2');
          container.appendChild(text);

          count++;
        });

        // Avatar en el centro frente a ti (√°ngulo 0)
        const avatar = document.createElement('a-entity');
        avatar.setAttribute('gltf-model', '#avatarModel');
        avatar.setAttribute('position', '0 0 -3');
        avatar.setAttribute('scale', '1.5 1.5 1.5');
        avatar.setAttribute('rotation', '0 0 0');
        
        avatar.addEventListener('model-loaded', () => {
          console.log('‚úì Avatar cargado');
          avatar.setAttribute('animation-mixer', 'clip: *; loop: repeat');
        });
        
        container.appendChild(avatar);

        info.innerHTML = `‚úì ${count} cubos + avatar colocados<br>Gira 360¬∞ LENTAMENTE<br>Busca n√∫meros amarillos del 1 al 8`;
        
        document.getElementById('testBtn').textContent = '‚úì Colocado - Busca los n√∫meros';
        document.getElementById('testBtn').style.background = 'rgba(0,150,0,0.9)';

        console.log('Objetos colocados en c√≠rculo alrededor del usuario');
      };

      // Limpieza
      window.addEventListener('beforeunload', () => {
        if (stream) stream.getTracks().forEach(t => t.stop());
      });
    </script>
  </body>
</html>